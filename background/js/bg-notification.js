"use strict";var bgNotification={init:function(){self=this,infinity.onMessage("dellAnocation",function(i){var n=infinity.get("infinity-notifications"),t=n.filter(function(n,t){if(n.time==i.time)return t});0===t&&infinity.set("infinity-notifications-latelyid",i.time),n.splice(t,1),infinity.set("infinity-notifications",n),infinity.sendMessage("infinity-noticationsDone")}),infinity.onMessage("dellAllnocation",function(){var i=infinity.get("infinity-notifications");infinity.set("infinity-notifications-latelyid",i[0].time),infinity.set("infinity-notifications",[]),infinity.sendMessage("infinity-noticationsDone")}),infinity.socket({name:"notificationws",isCheckHeart:!0,isNeedLogin:!1,event:{onopen:function(i,n){var t={type:"getLatestUnexpireNotification"};t=JSON.stringify(t),n.send(t)},onmessage:function(i,n){var t=[];infinity.init("infinity-notifications",t);try{var e=JSON.parse(i.data)}catch(i){return}if(200==e.status){var f=e.notifications;if("false"==f)return;var o=f.language,a=chrome.i18n.getUILanguage();if(-1==["zh-CN","en-US"].indexOf(a)&&(a="infinity-else"),-1!=o.indexOf(a)){var s=f.time,c=infinity.get("infinity-notifications-latelyid");if(c&&parseInt(c)>=s)return;var r=infinity.get("infinity-notifications");if(r instanceof Array){for(var y=!1,l=0;l<r.length;l++)r[l].time==s&&(y=!0);if(y)return;r.unshift(f),infinity.set("infinity-notifications-latelyid",s),infinity.set("infinity-notifications",r)}if(f.isAlert){var g,u=$("<div></div>");u.html(f.richText),g=u.text().trim(),void 0;var m={type:"basic",contextMessage:"",title:f.title,message:g,iconUrl:"img/notification.png",isClickable:!0},d="";f.link&&(d=f.link+"?time="+s),chrome.notifications.create(d,m,bgGmail.replyClosed)}}}}}})},checkIsHtml:function(i){return/<[^>]+>/g.test(i)}};