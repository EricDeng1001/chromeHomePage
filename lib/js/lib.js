"use strict";var infinity={extId:chrome.runtime.id,domain:"infinity-api.infinitynewtab.com/",url:"https://infinity-api.infinitynewtab.com/",lang:chrome.i18n.getUILanguage(),isMac:navigator.platform.indexOf("Mac")>=0,iconSize:240,modules:{},isDevelopmentEnvironment:!0};infinity.import=function(n,i,t){var e=n.substr(n.lastIndexOf("/")+1),r=document.createElement("link");r.setAttribute("name",e),r.rel="import",r.href=n+"/"+e+".html";var o=document.createElement("link");o.rel="stylesheet",o.href=n+"/"+e+".css",document.head.appendChild(o),document.head.appendChild(r),document.querySelector("[name="+e+"]").onload=function(){var n=document.querySelector('link[name="'+e+'"]').import.querySelector("template").content;document.querySelector(i).appendChild(n),document.querySelector('script[name="'+e+'-js"]').onload=function(){t&&t()}}},infinity.id=function(n){function i(n){return("0"+n.toString(16)).substr(-2)}return function(t){var e=new Uint8Array((t||40)/2);return window.crypto.getRandomValues(e),n+(new Date).getTime().toString(16)+Array.from(e,i).join("").substr(-10)}()},infinity.with=function(n,i,t){var e="string"==typeof arguments[1];if(infinity.modules.hasOwnProperty(n))e?t&&t(infinity.modules[n]):i&&i(infinity.modules[n]);else{var r;r=e?i:"body",infinity.import("/modules/"+n,r,function(){e?(infinity.modules[n]=infinity.modules[n]||!0,t&&t(infinity.modules[n])):(infinity.modules[n]=infinity.modules[n]||!0,i&&i(infinity.modules[n]))})}},infinity.require=function(n,i){var t=n.substr(n.lastIndexOf("/")+1);if(infinity.modules.hasOwnProperty(t))i&&i(infinity.modules[t]);else{var e=document.createElement("script");e.setAttribute("async","true"),e.src=n+".js",document.head.appendChild(e),e.onload=function(){infinity.modules[t]=infinity.modules[t]||!0,i&&i(infinity.modules[t])}}},infinity.init=function(n,i,t,e){try{localStorage[n]||(localStorage[n]=JSON.stringify(i))}catch(n){}},infinity.set=function(n,i,t,e){try{if(t){var r={};r[n]=JSON.stringify(i),chrome.storage.local.set(r,function(){e&&e()})}else localStorage[n]=JSON.stringify(i)}catch(n){void 0}},infinity.get=function(n,i,t){try{if(!i)return JSON.parse(localStorage[n]);chrome.storage.local.get(n,function(i){try{var e=JSON.parse(i[n]);t&&t(e)}catch(n){t&&t(null)}})}catch(n){return null}},infinity.isLogin=function(n){try{return!!infinity.get("infinity-user").isLogin}catch(n){return!1}},infinity.getUserInfo=function(){return infinity.get("infinity-user")},infinity.logout=function(n){infinity.sendMessage("logout")},infinity.i18n=function(n){try{return void 0==n?n:chrome.i18n.getMessage(n)||n}catch(i){return n}},infinity.isZh=function(){return"zh-CN"==chrome.i18n.getUILanguage()},infinity.sendMessage=function(n,i,t){chrome.runtime.sendMessage({name:n,message:i},function(n){t&&t(n)})},infinity.onMessage=function(n,i){chrome.runtime.onMessage.addListener(function(t,e,r){var o=t.message;t.name==n&&i&&i(o,e,r)})},infinity.broadcast=function(n,i,t){var e=i||{};chrome.tabs.getCurrent(function(i){e.tabId=i.id,infinity.sendMessage("infinity-broadcast-"+n,e,t)})},infinity.onBroadcast=function(n,i,t){infinity.onMessage("infinity-onBroadcast-"+n,function(n,e,r){"boolean"==typeof i&&i?t&&t(n,e,r):chrome.tabs.getCurrent(function(t){t.id!=n.tabId&&i&&i(n,e,r)})})},infinity.reset=function(){infinity.sendMessage("reset")},infinity.setting=function(n,i){if(void 0===i)return infinity.get("infinity-settings")[n];var t=infinity.get("infinity-settings");return t[n]=i,infinity.set("infinity-settings",t),!0},infinity.settingInitOrReset=function(n,i){try{var t=infinity.get("infinity-settings");t||(t={},infinity.set("infinity-settings",t));for(var e in n)i?infinity.setting(e,n[e]):(t=infinity.get("infinity-settings")).hasOwnProperty(e)||infinity.setting(e,n[e])}catch(n){}},infinity.isUrl=function(n){return 0==n.indexOf("http://")||0==n.indexOf("https://")||0==n.indexOf("ftp://")||0==n.indexOf("chrome://")||0==n.indexOf("file://")||0==n.indexOf("mailto:")||0==n.indexOf("tel:")||0==n.indexOf("chrome-app://")||0==n.indexOf("infinity://")||(n="http://"+n),{isValid:/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(n),str:n}},infinity.setIconImageBgColorSrc=function(n,i,t,e){if("transparent"!=n){var r=document.getElementById("transIconCanvas"),o=r.getContext("2d"),f=infinity.iconSize,s=f;i&&(s=.56*f);var a=(f-s)/2;o.clearRect(0,0,f,f),r.width=f,r.height=f;var c=new Image;c.src=t,c.onload=function(){o.fillStyle=n,o.fillRect(0,0,f,f),o.drawImage(c,a,a,s,s);var i=r.toDataURL("image/png");e&&e(i)}}else e&&e(t)};