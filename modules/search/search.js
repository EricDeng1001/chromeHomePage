!function(){"use strict";function showSearchBox(){$(".search-select-box").removeClass("infinity-fadeOut").css("display","flex").addClass("infinity-fadeIn"),$(".search-cover").removeClass("infinity-fadeOut").show().addClass("infinity-fadeIn")}function hideSearchBox(){$(".search-select-box").removeClass("infinity-fadeIn").addClass("infinity-fadeOut"),$(".search-cover").removeClass("infinity-fadeIn").addClass("infinity-fadeOut")}$(".search-choice").click(function(e){showSearchBox()}),$(".search-cover").click(function(e){hideSearchBox()}),$(".search-item-addBu").click(function(e){infinity.with("search-add",function(e){e.show()})}),$(document).on("mouseover",".search-item-delete",function(e){e.preventDefault(),$(".search-item:not(.search-item-addBu)").addClass("search-item-unhover")}),$(document).on("mouseout",".search-item-delete",function(e){e.preventDefault(),$(".search-item").removeClass("search-item-unhover")}),$(document).on("click",".home-content",function(e){$(e.target).parents(".search-box").length||(search.showSu=!1)}),infinity.modules.search=new Vue({el:"#search",data:{select:"",input:"",current:"",items:[],suggestions:[],searchSuggesutAjaxZh:!1,searchSuggesutAjaxOther:!1,suIndex:-1,preInput:"",showSu:!0,infinitySearch:{name:infinity.i18n("search"),seId:"dd3af9cc97ad7de8984baaf59514bb52",logo:"https://infinity-permanent.infinitynewtab.com/infinity/search-add/infinitySearch.png?imageView2/0/format/webp/q/100",desc:infinity.i18n("infinity_search_desc"),types:[{name:infinity.i18n("web"),url:"infinity://search/"},{name:infinity.i18n("images"),url:"https://www.google.com/search?tbm=isch&q="},{name:infinity.i18n("news"),url:"https://www.google.com/search?tbm=nws&q="},{name:infinity.i18n("videos"),url:"https://www.google.com/search?tbm=vid&q="},{name:infinity.i18n("maps"),url:"https://www.google.com/maps/preview?q="}]}},created:function(){var e=this;e.init(),infinity.onBroadcast("searchUpdate",function(){e.init()}),$(".search-select-box").on("animationend",function(e){e.preventDefault(),e.target.className.indexOf("infinity-fadeOut")>=0&&($(".search-select-box").hide(),$(".search-cover").hide())}),$(document).on("click",function(t){var n=$(t.target);n.parents("#search").length>0&&n.parents(".search-choice").length<0||(e.showSu=!1)})},methods:{onInputBlur:function(){},go:function(e){var t=this,n=infinity.setting("isSearchInNewTab")?"_blank":"_self";if(e)if(e.isUrl)window.open(e.text,n);else{i=t.select.url+encodeURIComponent(e.text);t.search(i,n)}else if(t.suggestions[t.suIndex]&&t.suggestions[t.suIndex].isUrl){i=t.suggestions[t.suIndex].text;t.search(i,n)}else{var i=t.select.url+encodeURIComponent(t.input);t.search(i,n)}},search:function(e,t){if(0==e.indexOf("infinity://search/")){var n=decodeURIComponent(e.substr(18,e.length));infinity.with("infinity-search",function(e){e.show(n)})}else window.open(e,t)},focus:function(){$(".search-input")[0].focus()},change:function(e,t){var n=this;if("search-item-delete"===t.target.className){var i=infinity.get("infinity-searchs");if(e.logo==i.current.logo)infinity.with("info",function(e){e.show(infinity.i18n("cannot_delete_current_search"),!0)});else{s=n.items.indexOf(e);n.items.splice(s,1),(i=infinity.get("infinity-searchs")).all=n.items,infinity.set("infinity-searchs",i),infinity.broadcast("searchUpdate"),infinity.broadcast("searchAddUpdate")}}else{var s=n.items.indexOf(e);n.current=n.items[s],(i={}).all=n.items,i.current=n.current,n.select=n.current.types[0],infinity.set("infinity-searchs",i),infinity.broadcast("searchUpdate"),infinity.broadcast("searchAddUpdate"),hideSearchBox(),n.focus()}},changeToInfinity:function(){var e=this,t=infinity.get("infinity-searchs");t.current=e.infinitySearch,e.current=e.infinitySearch,e.select=e.current.types[0],infinity.set("infinity-searchs",t),infinity.broadcast("searchUpdate"),infinity.broadcast("searchAddUpdate"),hideSearchBox(),e.focus()},changeType:function(e){var t=this;t.select=e,t.focus()},init:function(){var e=this,t=infinity.get("infinity-searchs");e.current=t.current,e.items=t.all,e.select=t.current.types[0]},onInputFocus:function(){},inputSuggest:function(e){this.startSuggest()},keyupSuggest:function(e){var t=this;32==e.which&&t.startSuggest()},startSuggest:function(e){var t=this;if(t.showSu=!0,t.preInput=t.input,""==t.input)return t.suggestions=[],t.suIndex=-1,t.searchSuggesutAjaxZh&&t.searchSuggesutAjaxZh.abort(),void(t.searchSuggesutAjaxOther&&t.searchSuggesutAjaxOther.abort());infinity.isZh()?t.getZhSuggestion():t.getOtherSuggestion()},getZhSuggestion:function(){var self=this;self.searchSuggesutAjaxZh&&self.searchSuggesutAjaxZh.abort(),self.searchSuggesutAjaxZh=$.get({url:"http://suggestion.baidu.com/su?wd="+self.input+"&p=3&t="+(new Date).getTime()+"&cb=",dataType:"text",success:function(data){try{var res=eval(data),suObj=res.s,arr=[];suObj.map(function(e,t){var n={isUrl:!1,text:suObj[t]};arr.push(n)}),self.suggestions=arr.splice(0,8)}catch(e){}}})},getOtherSuggestion:function(){var e=this;e.searchSuggesutAjaxOther&&e.searchSuggesutAjaxOther.abort(),e.searchSuggesutAjaxOther=$.get({url:"http://google.com/complete/search?client=chrome&q="+e.input+"&hl="+chrome.i18n.getUILanguage()+"&infinityTime="+(new Date).getTime(),dataType:"json",success:function(t){try{var n=[];t[2].map(function(e,i){var s={isUrl:!1,text:t[1][i]};""!=e&&(s.isUrl=!0),n.push(s)}),e.suggestions=n.splice(0,8)}catch(e){}}})},down:function(e){e.preventDefault();var t=this;t.suIndex+=1,t.suIndex==t.suggestions.length?(t.suIndex=-1,t.input=t.preInput):t.input=t.suggestions[t.suIndex].text},up:function(e){e.preventDefault();var t=this;t.suIndex-=1,-2==t.suIndex&&(t.suIndex=t.suggestions.length-1),-1==t.suIndex?t.input=t.preInput:t.input=t.suggestions[t.suIndex].text}}})}();